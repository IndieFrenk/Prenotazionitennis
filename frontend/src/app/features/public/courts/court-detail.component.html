<!-- Page header -->
<app-header />

<main class="court-detail-page">
  <!-- Loading state -->
  @if (loading) {
    <app-loading-spinner />
  }

  <!-- Error state -->
  @if (errorMessage && !loading) {
    <div class="error-state">
      <i class="pi pi-exclamation-triangle"></i>
      <p>{{ errorMessage }}</p>
      <p-button
        label="Torna ai campi"
        icon="pi pi-arrow-left"
        severity="secondary"
        (onClick)="goBack()"
      />
    </div>
  }

  <!-- Court detail content -->
  @if (court && !loading) {
    <!-- Back button -->
    <div class="back-nav">
      <p-button
        label="Torna ai campi"
        icon="pi pi-arrow-left"
        severity="secondary"
        [text]="true"
        (onClick)="goBack()"
      />
    </div>

    <!-- Court header -->
    <div class="court-header">
      <div class="court-title-row">
        <h1>{{ court.name }}</h1>
        <p-tag
          [value]="court.type"
          [severity]="getTypeSeverity(court.type)"
          styleClass="court-type-tag"
        />
      </div>
    </div>

    <!-- Photo gallery or stock image -->
    <section class="gallery-section">
      @if (sortedPhotos.length > 0) {
        <p-galleria
          [value]="sortedPhotos"
          [responsiveOptions]="galleriaResponsiveOptions"
          [numVisible]="5"
          [circular]="true"
          [showItemNavigators]="true"
          [showThumbnails]="sortedPhotos.length > 1"
          styleClass="court-gallery"
        >
          <ng-template pTemplate="item" let-photo>
            <img
              [src]="photo.imageUrl"
              [alt]="photo.altText || court.name"
              class="gallery-image"
            />
          </ng-template>
          <ng-template pTemplate="thumbnail" let-photo>
            <img
              [src]="photo.imageUrl"
              [alt]="photo.altText || court.name"
              class="gallery-thumbnail"
            />
          </ng-template>
        </p-galleria>
      } @else {
        <div class="stock-image-wrapper">
          <img
            [src]="stockImageUrl"
            [alt]="court.name"
            class="stock-image"
          />
        </div>
      }
    </section>

    <!-- Court details grid -->
    <div class="detail-grid grid">
      <!-- Left column: description and info -->
      <div class="col-12 lg:col-8">
        <p-card header="Descrizione" styleClass="detail-card">
          <p class="court-description">{{ court.description }}</p>

          <p-divider />

          <!-- Opening hours -->
          <div class="info-row">
            <i class="pi pi-clock"></i>
            <div class="info-content">
              <span class="info-label">Orario di apertura</span>
              <span class="info-value">{{ court.openingTime }} - {{ court.closingTime }}</span>
            </div>
          </div>

          <!-- Slot duration -->
          <div class="info-row">
            <i class="pi pi-stopwatch"></i>
            <div class="info-content">
              <span class="info-label">Durata slot</span>
              <span class="info-value">{{ court.slotDurationMinutes }} minuti</span>
            </div>
          </div>
        </p-card>
      </div>

      <!-- Right column: prices and booking -->
      <div class="col-12 lg:col-4">
        <p-card header="Tariffe" styleClass="detail-card price-card">
          <p-table [value]="priceRows" styleClass="p-datatable-sm">
            <ng-template pTemplate="body" let-row>
              <tr>
                <td class="price-label-cell">{{ row.label }}</td>
                <td class="price-value-cell">{{ row.value }}</td>
              </tr>
            </ng-template>
          </p-table>

          <div class="booking-action">
            <p-button
              label="Prenota questo campo"
              icon="pi pi-calendar-plus"
              severity="primary"
              styleClass="w-full"
              (onClick)="bookCourt()"
            />
          </div>
        </p-card>
      </div>
    </div>
  }
</main>

<!-- Page footer -->
<app-footer />
